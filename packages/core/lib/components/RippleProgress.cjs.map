{"version":3,"file":"RippleProgress.cjs","sources":["../../src/components/RippleProgress.ts"],"sourcesContent":["import { RippleProgressOptions, RippleCircle } from '../types';\nimport { ProgressBase } from '../base';\nimport { createElement, canvasContextCache } from '../utils';\n\n/**\n * RippleProgress - 涟漪扩散进度条\n */\nexport class RippleProgress extends ProgressBase<RippleProgressOptions> {\n  private wrapper!: HTMLElement;\n  private canvas!: HTMLCanvasElement;\n  private ctx!: CanvasRenderingContext2D;\n  private ripples: RippleCircle[] = [];\n  private animationId?: string;\n  private textElement?: HTMLElement;\n\n  protected getDefaultOptions(): Partial<RippleProgressOptions> {\n    return {\n      ...super.getDefaultOptions(),\n      size: 150,\n      rippleCount: 3,\n      rippleSpeed: 0.5,\n      rippleColor: '#409eff',\n      maxRadius: 100,\n    };\n  }\n\n  protected render(): void {\n    this.container.innerHTML = '';\n\n    const size = this.config.get('size') ?? 150;\n\n    // 创建包装器\n    this.wrapper = createElement('div', 'ld-progress-ripple', this.container);\n    this.wrapper.style.width = `${size}px`;\n    this.wrapper.style.height = `${size}px`;\n    this.wrapper.style.position = 'relative';\n\n    const className = this.config.get('className');\n    if (className) {\n      this.wrapper.classList.add(className);\n    }\n\n    // 创建 Canvas\n    this.canvas = createElement('canvas', 'ld-progress-ripple__canvas', this.wrapper) as HTMLCanvasElement;\n    this.canvas.width = size;\n    this.canvas.height = size;\n\n    this.ctx = canvasContextCache.get(this.canvas);\n\n    // 创建文本\n    if (this.config.get('showText')) {\n      this.textElement = createElement('div', 'ld-progress-ripple__text', this.wrapper);\n      this.textElement.style.position = 'absolute';\n      this.textElement.style.top = '50%';\n      this.textElement.style.left = '50%';\n      this.textElement.style.transform = 'translate(-50%, -50%)';\n      this.textElement.style.fontSize = '20px';\n      this.textElement.style.fontWeight = 'bold';\n      this.textElement.style.zIndex = '10';\n    }\n\n    this.startAnimation();\n    this.updateProgress(this.currentValue);\n  }\n\n  /**\n   * 开始动画\n   */\n  private startAnimation(): void {\n    if (this.animationId) return;\n\n    const { rafController } = require('../utils/RAFController');\n    this.animationId = `ripple-${this.id}`;\n\n    rafController.register(this.animationId, () => {\n      this.updateRipples();\n      this.drawRipples();\n    }, 0);\n  }\n\n  /**\n   * 停止动画\n   */\n  private stopAnimation(): void {\n    if (this.animationId) {\n      const { rafController } = require('../utils/RAFController');\n      rafController.unregister(this.animationId);\n      this.animationId = undefined;\n    }\n  }\n\n  /**\n   * 更新涟漪\n   */\n  private updateRipples(): void {\n    const percentage = this.config.getPercentage(this.currentValue);\n    const rippleCount = this.config.get('rippleCount') ?? 3;\n    const maxRadius = this.config.get('maxRadius') ?? 100;\n    const rippleSpeed = this.config.get('rippleSpeed') ?? 0.5;\n\n    // 生成新涟漪\n    if (percentage > 0 && this.ripples.length < rippleCount * 2) {\n      if (Math.random() < 0.05) {\n        this.ripples.push({\n          radius: 0,\n          alpha: 1,\n          maxRadius: (maxRadius * percentage) / 100,\n        });\n      }\n    }\n\n    // 更新涟漪\n    this.ripples = this.ripples.filter(ripple => {\n      ripple.radius += rippleSpeed;\n      ripple.alpha -= 0.01;\n      return ripple.alpha > 0 && ripple.radius <= ripple.maxRadius;\n    });\n  }\n\n  /**\n   * 绘制涟漪\n   */\n  private drawRipples(): void {\n    if (!this.ctx) return;\n\n    const size = this.canvas.width;\n    const center = size / 2;\n    const rippleColor = this.config.get('rippleColor') || '#409eff';\n\n    // 清除画布\n    this.ctx.clearRect(0, 0, size, size);\n\n    // 绘制所有涟漪\n    this.ripples.forEach(ripple => {\n      this.ctx.beginPath();\n      this.ctx.arc(center, center, ripple.radius, 0, Math.PI * 2);\n      this.ctx.strokeStyle = rippleColor;\n      this.ctx.lineWidth = 2;\n      this.ctx.globalAlpha = ripple.alpha;\n      this.ctx.stroke();\n    });\n\n    this.ctx.globalAlpha = 1;\n  }\n\n  protected updateProgress(value: number): void {\n    if (this.textElement) {\n      this.textElement.textContent = this.formatText(value);\n    }\n  }\n\n  /**\n   * 销毁\n   */\n  destroy(): void {\n    this.stopAnimation();\n    super.destroy();\n  }\n}\n\n\n\n"],"names":["ProgressBase","createElement","canvasContextCache"],"mappings":"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"}