{"version":3,"file":"ParticleProgress.js","sources":["../../src/components/ParticleProgress.ts"],"sourcesContent":["import { ParticleProgressOptions, Particle } from '../types';\nimport { ProgressBase } from '../base';\nimport { createElement, canvasContextCache } from '../utils';\n\n/**\n * ParticleProgress - 粒子流动进度条\n */\nexport class ParticleProgress extends ProgressBase<ParticleProgressOptions> {\n  private wrapper!: HTMLElement;\n  private canvas!: HTMLCanvasElement;\n  private ctx!: CanvasRenderingContext2D;\n  private particles: Particle[] = [];\n  private animationId?: string;\n  private textElement?: HTMLElement;\n\n  protected getDefaultOptions(): Partial<ParticleProgressOptions> {\n    return {\n      ...super.getDefaultOptions(),\n      width: 300,\n      height: 20,\n      particleCount: 50,\n      particleSize: 3,\n      particleSpeed: 2,\n      particleColor: '#409eff',\n      trailLength: 5,\n    };\n  }\n\n  protected render(): void {\n    this.container.innerHTML = '';\n\n    const width = this.config.get('width') ?? 300;\n    const height = this.config.get('height') ?? 20;\n\n    // 创建包装器\n    this.wrapper = createElement('div', 'ld-progress-particle', this.container);\n    this.wrapper.style.position = 'relative';\n    this.wrapper.style.width = `${width}px`;\n    this.wrapper.style.height = `${height}px`;\n    this.wrapper.style.backgroundColor = '#f5f5f5';\n    this.wrapper.style.borderRadius = '10px';\n    this.wrapper.style.overflow = 'hidden';\n\n    const className = this.config.get('className');\n    if (className) {\n      this.wrapper.classList.add(className);\n    }\n\n    // 创建 Canvas\n    this.canvas = createElement('canvas', 'ld-progress-particle__canvas', this.wrapper) as HTMLCanvasElement;\n    this.canvas.width = typeof width === 'number' ? width : parseInt(String(width));\n    this.canvas.height = typeof height === 'number' ? height : parseInt(String(height));\n    this.canvas.style.position = 'absolute';\n\n    this.ctx = canvasContextCache.get(this.canvas);\n\n    // 初始化粒子\n    this.initParticles();\n\n    // 创建文本\n    if (this.config.get('showText')) {\n      this.textElement = createElement('div', 'ld-progress-particle__text', this.wrapper);\n      this.textElement.style.position = 'absolute';\n      this.textElement.style.right = '10px';\n      this.textElement.style.top = '50%';\n      this.textElement.style.transform = 'translateY(-50%)';\n      this.textElement.style.fontSize = '12px';\n      this.textElement.style.zIndex = '10';\n    }\n\n    this.startAnimation();\n    this.updateProgress(this.currentValue);\n  }\n\n  /**\n   * 初始化粒子\n   */\n  private initParticles(): void {\n    const particleCount = this.config.get('particleCount') ?? 50;\n    const width = this.canvas.width;\n    const height = this.canvas.height;\n\n    this.particles = [];\n    for (let i = 0; i < particleCount; i++) {\n      this.particles.push({\n        x: Math.random() * width,\n        y: height / 2 + (Math.random() - 0.5) * height * 0.5,\n        vx: (Math.random() * 0.5 + 0.5) * (this.config.get('particleSpeed') ?? 2),\n        vy: (Math.random() - 0.5) * 0.5,\n        size: (Math.random() * 0.5 + 0.5) * (this.config.get('particleSize') ?? 3),\n        alpha: Math.random() * 0.5 + 0.5,\n        trail: [],\n      });\n    }\n  }\n\n  /**\n   * 开始动画\n   */\n  private startAnimation(): void {\n    if (this.animationId) return;\n\n    const { rafController } = require('../utils/RAFController');\n    this.animationId = `particle-${this.id}`;\n\n    rafController.register(this.animationId, () => {\n      this.updateParticles();\n      this.drawParticles();\n    }, 0);\n  }\n\n  /**\n   * 停止动画\n   */\n  private stopAnimation(): void {\n    if (this.animationId) {\n      const { rafController } = require('../utils/RAFController');\n      rafController.unregister(this.animationId);\n      this.animationId = undefined;\n    }\n  }\n\n  /**\n   * 更新粒子位置\n   */\n  private updateParticles(): void {\n    const width = this.canvas.width;\n    const height = this.canvas.height;\n    const percentage = this.config.getPercentage(this.currentValue);\n    const maxX = (width * percentage) / 100;\n    const trailLength = this.config.get('trailLength') ?? 5;\n\n    this.particles.forEach(particle => {\n      // 保存轨迹\n      if (particle.trail) {\n        particle.trail.push({ x: particle.x, y: particle.y });\n        if (particle.trail.length > trailLength) {\n          particle.trail.shift();\n        }\n      }\n\n      // 更新位置\n      particle.x += particle.vx;\n      particle.y += particle.vy;\n\n      // 边界检查\n      if (particle.x > maxX || particle.x > width) {\n        particle.x = 0;\n        particle.y = height / 2 + (Math.random() - 0.5) * height * 0.5;\n      }\n\n      if (particle.y < 0 || particle.y > height) {\n        particle.vy *= -1;\n      }\n    });\n  }\n\n  /**\n   * 绘制粒子\n   */\n  private drawParticles(): void {\n    if (!this.ctx) return;\n\n    const width = this.canvas.width;\n    const height = this.canvas.height;\n    const particleColor = this.config.get('particleColor') || '#409eff';\n\n    // 清除画布（带淡出效果）\n    this.ctx.fillStyle = 'rgba(245, 245, 245, 0.3)';\n    this.ctx.fillRect(0, 0, width, height);\n\n    // 绘制粒子\n    this.particles.forEach(particle => {\n      // 绘制轨迹\n      if (particle.trail && particle.trail.length > 1) {\n        this.ctx.beginPath();\n        this.ctx.moveTo(particle.trail[0].x, particle.trail[0].y);\n        particle.trail.forEach(point => {\n          this.ctx.lineTo(point.x, point.y);\n        });\n        this.ctx.strokeStyle = particleColor;\n        this.ctx.globalAlpha = particle.alpha * 0.3;\n        this.ctx.lineWidth = particle.size * 0.5;\n        this.ctx.stroke();\n      }\n\n      // 绘制粒子\n      this.ctx.beginPath();\n      this.ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);\n      this.ctx.fillStyle = particleColor;\n      this.ctx.globalAlpha = particle.alpha;\n      this.ctx.fill();\n    });\n\n    this.ctx.globalAlpha = 1;\n  }\n\n  protected updateProgress(value: number): void {\n    if (this.textElement) {\n      this.textElement.textContent = this.formatText(value);\n    }\n  }\n\n  /**\n   * 销毁\n   */\n  destroy(): void {\n    this.stopAnimation();\n    super.destroy();\n  }\n}\n\n\n\n"],"names":[],"mappings":"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"}