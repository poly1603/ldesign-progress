{"version":3,"file":"LiquidProgress.cjs","sources":["../../src/components/LiquidProgress.ts"],"sourcesContent":["import { LiquidProgressOptions } from '../types';\nimport { ProgressBase } from '../base';\nimport { createElement, canvasContextCache } from '../utils';\n\n/**\n * LiquidProgress - 液体填充效果进度条\n */\nexport class LiquidProgress extends ProgressBase<LiquidProgressOptions> {\n  private wrapper!: HTMLElement;\n  private canvas!: HTMLCanvasElement;\n  private ctx!: CanvasRenderingContext2D;\n  private animationId?: string;\n  private waveOffset: number = 0;\n  private textElement?: HTMLElement;\n\n  protected getDefaultOptions(): Partial<LiquidProgressOptions> {\n    return {\n      ...super.getDefaultOptions(),\n      width: 200,\n      height: 200,\n      shape: 'circle',\n      waveHeight: 8,\n      waveSpeed: 0.03,\n      liquidColor: '#409eff',\n      backgroundColor: '#e4e7ed',\n    };\n  }\n\n  protected render(): void {\n    this.container.innerHTML = '';\n\n    const width = this.config.get('width') ?? 200;\n    const height = this.config.get('height') ?? 200;\n\n    // 创建包装器\n    this.wrapper = createElement('div', 'ld-progress-liquid', this.container);\n    this.wrapper.style.position = 'relative';\n    this.wrapper.style.width = `${width}px`;\n    this.wrapper.style.height = `${height}px`;\n    this.wrapper.style.backgroundColor = this.config.get('backgroundColor') || '#e4e7ed';\n    this.wrapper.style.overflow = 'hidden';\n\n    // 设置形状\n    const shape = this.config.get('shape') ?? 'circle';\n    if (shape === 'circle') {\n      this.wrapper.style.borderRadius = '50%';\n    } else if (shape === 'rounded') {\n      this.wrapper.style.borderRadius = '20px';\n    }\n\n    const className = this.config.get('className');\n    if (className) {\n      this.wrapper.classList.add(className);\n    }\n\n    // 创建 Canvas\n    this.canvas = createElement('canvas', 'ld-progress-liquid__canvas', this.wrapper) as HTMLCanvasElement;\n    this.canvas.width = typeof width === 'number' ? width : parseInt(String(width));\n    this.canvas.height = typeof height === 'number' ? height : parseInt(String(height));\n    this.canvas.style.position = 'absolute';\n    this.canvas.style.top = '0';\n    this.canvas.style.left = '0';\n\n    this.ctx = canvasContextCache.get(this.canvas);\n\n    // 创建文本\n    if (this.config.get('showText')) {\n      this.textElement = createElement('div', 'ld-progress-liquid__text', this.wrapper);\n      this.textElement.style.position = 'absolute';\n      this.textElement.style.top = '50%';\n      this.textElement.style.left = '50%';\n      this.textElement.style.transform = 'translate(-50%, -50%)';\n      this.textElement.style.fontSize = '24px';\n      this.textElement.style.fontWeight = 'bold';\n      this.textElement.style.zIndex = '10';\n    }\n\n    this.updateProgress(this.currentValue);\n    this.startAnimation();\n  }\n\n  /**\n   * 开始动画\n   */\n  private startAnimation(): void {\n    if (this.animationId) return;\n\n    const { rafController } = require('../utils/RAFController');\n    this.animationId = `liquid-${this.id}`;\n\n    rafController.register(this.animationId, () => {\n      this.drawLiquid();\n      const waveSpeed = this.config.get('waveSpeed') ?? 0.03;\n      this.waveOffset += waveSpeed;\n    }, 0);\n  }\n\n  /**\n   * 停止动画\n   */\n  private stopAnimation(): void {\n    if (this.animationId) {\n      const { rafController } = require('../utils/RAFController');\n      rafController.unregister(this.animationId);\n      this.animationId = undefined;\n    }\n  }\n\n  /**\n   * 绘制液体\n   */\n  private drawLiquid(): void {\n    if (!this.ctx || !this.canvas) return;\n\n    const width = this.canvas.width;\n    const height = this.canvas.height;\n    const percentage = this.config.getPercentage(this.currentValue);\n    const waveHeight = this.config.get('waveHeight') ?? 8;\n\n    // 清除画布\n    this.ctx.clearRect(0, 0, width, height);\n\n    // 计算液面高度\n    const waterLevel = height - (height * percentage) / 100;\n\n    // 绘制液体波浪\n    this.ctx.beginPath();\n    this.ctx.moveTo(0, waterLevel);\n\n    for (let x = 0; x <= width; x++) {\n      const y = waterLevel +\n        Math.sin((x / width) * Math.PI * 4 + this.waveOffset) * waveHeight +\n        Math.sin((x / width) * Math.PI * 2 + this.waveOffset * 1.5) * (waveHeight * 0.5);\n      this.ctx.lineTo(x, y);\n    }\n\n    this.ctx.lineTo(width, height);\n    this.ctx.lineTo(0, height);\n    this.ctx.closePath();\n\n    // 填充液体颜色\n    const liquidColor = this.config.get('liquidColor') || '#409eff';\n    this.ctx.fillStyle = liquidColor;\n    this.ctx.fill();\n\n    // 添加高光效果\n    const gradient = this.ctx.createLinearGradient(0, waterLevel, 0, height);\n    gradient.addColorStop(0, 'rgba(255, 255, 255, 0.3)');\n    gradient.addColorStop(1, 'rgba(255, 255, 255, 0)');\n    this.ctx.fillStyle = gradient;\n    this.ctx.fill();\n  }\n\n  protected updateProgress(value: number): void {\n    // 更新文本\n    if (this.textElement) {\n      this.textElement.textContent = this.formatText(value);\n    }\n  }\n\n  /**\n   * 销毁\n   */\n  destroy(): void {\n    this.stopAnimation();\n    super.destroy();\n  }\n}\n\n\n\n"],"names":["ProgressBase","createElement","canvasContextCache"],"mappings":"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"}