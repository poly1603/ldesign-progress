{"version":3,"file":"ImageProgress.cjs","sources":["../../src/components/ImageProgress.ts"],"sourcesContent":["import { ImageProgressOptions } from '../types';\r\nimport { ProgressBase } from '../base';\r\nimport { createElement, toPx } from '../utils';\r\n\r\n/**\r\n * 图片填充进度条\r\n */\r\nexport class ImageProgress extends ProgressBase<ImageProgressOptions> {\r\n  private wrapper!: HTMLElement;\r\n  private imageContainer!: HTMLElement;\r\n  private image!: HTMLImageElement;\r\n  private maskElement?: HTMLElement;\r\n  private textElement?: HTMLElement;\r\n  private imageLoaded: boolean = false;\r\n\r\n  protected getDefaultOptions(): Partial<ImageProgressOptions> {\r\n    return {\r\n      ...super.getDefaultOptions(),\r\n      imageWidth: 200,\r\n      imageHeight: 200,\r\n      fillDirection: 'horizontal',\r\n      maskMode: false,\r\n      objectFit: 'cover',\r\n    };\r\n  }\r\n\r\n  protected render(): void {\r\n    // 清空容器\r\n    this.container.innerHTML = '';\r\n\r\n    // 创建包装器\r\n    this.wrapper = createElement('div', 'ld-progress-image', this.container);\r\n    this.wrapper.style.position = 'relative';\r\n    this.wrapper.style.display = 'inline-block';\r\n\r\n    // 设置尺寸\r\n    const width = this.config.get('imageWidth') ?? 200;\r\n    const height = this.config.get('imageHeight') ?? 200;\r\n    this.wrapper.style.width = toPx(width);\r\n    this.wrapper.style.height = toPx(height);\r\n    this.wrapper.style.overflow = 'hidden';\r\n\r\n    // 添加自定义类名\r\n    const className = this.config.get('className');\r\n    if (className) {\r\n      this.wrapper.classList.add(className);\r\n    }\r\n\r\n    // 创建图片容器\r\n    this.imageContainer = createElement('div', 'ld-progress-image__container', this.wrapper);\r\n    this.imageContainer.style.position = 'relative';\r\n    this.imageContainer.style.width = '100%';\r\n    this.imageContainer.style.height = '100%';\r\n\r\n    // 创建图片\r\n    this.image = document.createElement('img');\r\n    this.image.className = 'ld-progress-image__img';\r\n    this.image.style.width = '100%';\r\n    this.image.style.height = '100%';\r\n    this.image.style.objectFit = this.config.get('objectFit') || 'cover';\r\n    \r\n    const imageSrc = this.config.get('imageSrc');\r\n    if (!imageSrc) {\r\n      console.error('ImageProgress: imageSrc is required');\r\n      return;\r\n    }\r\n\r\n    this.image.src = imageSrc;\r\n    this.image.onload = () => {\r\n      this.imageLoaded = true;\r\n      this.updateProgress(this.currentValue);\r\n    };\r\n    this.image.onerror = () => {\r\n      console.error('ImageProgress: Failed to load image:', imageSrc);\r\n    };\r\n\r\n    this.imageContainer.appendChild(this.image);\r\n\r\n    // 创建遮罩层\r\n    if (this.config.get('maskMode')) {\r\n      this.maskElement = createElement('div', 'ld-progress-image__mask', this.wrapper);\r\n      this.maskElement.style.position = 'absolute';\r\n      this.maskElement.style.top = '0';\r\n      this.maskElement.style.left = '0';\r\n      this.maskElement.style.width = '100%';\r\n      this.maskElement.style.height = '100%';\r\n      this.maskElement.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';\r\n      this.maskElement.style.transition = 'all 0.3s';\r\n    }\r\n\r\n    // 创建文本\r\n    if (this.config.get('showText')) {\r\n      this.textElement = createElement('div', 'ld-progress-image__text', this.wrapper);\r\n      this.textElement.style.position = 'absolute';\r\n      this.textElement.style.top = '50%';\r\n      this.textElement.style.left = '50%';\r\n      this.textElement.style.transform = 'translate(-50%, -50%)';\r\n      this.textElement.style.color = 'white';\r\n      this.textElement.style.fontSize = '24px';\r\n      this.textElement.style.fontWeight = 'bold';\r\n      this.textElement.style.textShadow = '0 2px 4px rgba(0,0,0,0.5)';\r\n      this.textElement.style.zIndex = '10';\r\n    }\r\n\r\n    // 更新进度\r\n    this.updateProgress(this.currentValue);\r\n  }\r\n\r\n  protected updateProgress(value: number): void {\r\n    if (!this.imageLoaded) return;\r\n\r\n    const percentage = this.config.getPercentage(value);\r\n    const direction = this.config.get('fillDirection') ?? 'horizontal';\r\n\r\n    if (this.config.get('maskMode') && this.maskElement) {\r\n      // 遮罩模式：通过改变遮罩的透明度或大小\r\n      const opacity = 1 - percentage / 100;\r\n      this.maskElement.style.opacity = `${opacity}`;\r\n    } else {\r\n      // 裁剪模式：通过 clip-path 裁剪图片\r\n      const clipPath = this.getClipPath(percentage, direction);\r\n      this.imageContainer.style.clipPath = clipPath;\r\n    }\r\n\r\n    // 更新文本\r\n    if (this.textElement) {\r\n      this.textElement.textContent = this.formatText(value);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 根据进度和方向生成 clip-path\r\n   */\r\n  private getClipPath(percentage: number, direction: string): string {\r\n    switch (direction) {\r\n      case 'horizontal':\r\n        return `inset(0 ${100 - percentage}% 0 0)`;\r\n      case 'vertical':\r\n        return `inset(${100 - percentage}% 0 0 0)`;\r\n      case 'radial':\r\n        // 径向填充使用 circle\r\n        const radius = percentage / 2;\r\n        return `circle(${radius}% at 50% 50%)`;\r\n      default:\r\n        return `inset(0 ${100 - percentage}% 0 0)`;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 设置图片源\r\n   */\r\n  setImageSrc(src: string): void {\r\n    this.config.set('imageSrc', src);\r\n    this.imageLoaded = false;\r\n    if (this.image) {\r\n      this.image.src = src;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 设置填充方向\r\n   */\r\n  setFillDirection(direction: 'horizontal' | 'vertical' | 'radial'): void {\r\n    this.config.set('fillDirection', direction);\r\n    this.updateProgress(this.currentValue);\r\n  }\r\n}\r\n\r\n\r\n"],"names":["ProgressBase","createElement","toPx"],"mappings":"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"}