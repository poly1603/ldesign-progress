{"version":3,"file":"BubbleProgress.cjs","sources":["../../src/components/BubbleProgress.ts"],"sourcesContent":["import { BubbleProgressOptions, Bubble } from '../types';\nimport { ProgressBase } from '../base';\nimport { createElement, canvasContextCache } from '../utils';\n\n/**\n * BubbleProgress - 气泡上升进度条\n */\nexport class BubbleProgress extends ProgressBase<BubbleProgressOptions> {\n  private wrapper!: HTMLElement;\n  private canvas!: HTMLCanvasElement;\n  private ctx!: CanvasRenderingContext2D;\n  private bubbles: Bubble[] = [];\n  private animationId?: string;\n  private textElement?: HTMLElement;\n\n  protected getDefaultOptions(): Partial<BubbleProgressOptions> {\n    return {\n      ...super.getDefaultOptions(),\n      width: 150,\n      height: 300,\n      bubbleColor: 'rgba(64, 158, 255, 0.6)',\n      bubbleCount: 20,\n      bubbleSpeed: 2,\n      backgroundColor: '#e4e7ed',\n    };\n  }\n\n  protected render(): void {\n    this.container.innerHTML = '';\n\n    const width = this.config.get('width') ?? 150;\n    const height = this.config.get('height') ?? 300;\n\n    // 创建包装器\n    this.wrapper = createElement('div', 'ld-progress-bubble', this.container);\n    this.wrapper.style.width = `${width}px`;\n    this.wrapper.style.height = `${height}px`;\n    this.wrapper.style.position = 'relative';\n    this.wrapper.style.backgroundColor = this.config.get('backgroundColor') || '#e4e7ed';\n    this.wrapper.style.borderRadius = '10px';\n    this.wrapper.style.overflow = 'hidden';\n\n    const className = this.config.get('className');\n    if (className) {\n      this.wrapper.classList.add(className);\n    }\n\n    // 创建 Canvas\n    this.canvas = createElement('canvas', 'ld-progress-bubble__canvas', this.wrapper) as HTMLCanvasElement;\n    this.canvas.width = typeof width === 'number' ? width : parseInt(String(width));\n    this.canvas.height = typeof height === 'number' ? height : parseInt(String(height));\n\n    this.ctx = canvasContextCache.get(this.canvas);\n\n    // 创建文本\n    if (this.config.get('showText')) {\n      this.textElement = createElement('div', 'ld-progress-bubble__text', this.wrapper);\n      this.textElement.style.position = 'absolute';\n      this.textElement.style.top = '20px';\n      this.textElement.style.left = '50%';\n      this.textElement.style.transform = 'translateX(-50%)';\n      this.textElement.style.fontSize = '24px';\n      this.textElement.style.fontWeight = 'bold';\n      this.textElement.style.zIndex = '10';\n    }\n\n    this.initBubbles();\n    this.startAnimation();\n    this.updateProgress(this.currentValue);\n  }\n\n  /**\n   * 初始化气泡\n   */\n  private initBubbles(): void {\n    const width = this.canvas.width;\n    const height = this.canvas.height;\n    const bubbleCount = this.config.get('bubbleCount') ?? 20;\n\n    this.bubbles = [];\n    for (let i = 0; i < bubbleCount; i++) {\n      this.createBubble();\n    }\n  }\n\n  /**\n   * 创建单个气泡\n   */\n  private createBubble(): Bubble {\n    const width = this.canvas.width;\n    const height = this.canvas.height;\n    const bubbleSpeed = this.config.get('bubbleSpeed') ?? 2;\n\n    const bubble: Bubble = {\n      x: Math.random() * width,\n      y: height + Math.random() * 50,\n      radius: Math.random() * 10 + 5,\n      speed: Math.random() * bubbleSpeed + 0.5,\n      wobble: Math.random() * 2,\n      wobbleSpeed: Math.random() * 0.05,\n      alpha: Math.random() * 0.4 + 0.4,\n    };\n\n    this.bubbles.push(bubble);\n    return bubble;\n  }\n\n  /**\n   * 开始动画\n   */\n  private startAnimation(): void {\n    if (this.animationId) return;\n\n    const { rafController } = require('../utils/RAFController');\n    this.animationId = `bubble-${this.id}`;\n\n    rafController.register(this.animationId, () => {\n      this.updateBubbles();\n      this.drawBubbles();\n    }, 0);\n  }\n\n  /**\n   * 停止动画\n   */\n  private stopAnimation(): void {\n    if (this.animationId) {\n      const { rafController } = require('../utils/RAFController');\n      rafController.unregister(this.animationId);\n      this.animationId = undefined;\n    }\n  }\n\n  /**\n   * 更新气泡\n   */\n  private updateBubbles(): void {\n    const width = this.canvas.width;\n    const height = this.canvas.height;\n    const percentage = this.config.getPercentage(this.currentValue);\n    const limitY = height - (height * percentage) / 100;\n\n    this.bubbles.forEach((bubble, index) => {\n      // 更新位置\n      bubble.y -= bubble.speed;\n      bubble.x += Math.sin(bubble.wobble) * 0.5;\n      bubble.wobble += bubble.wobbleSpeed;\n\n      // 重置冒出界限或超过进度线的气泡\n      if (bubble.y + bubble.radius < 0 || bubble.y < limitY) {\n        this.bubbles[index] = this.createBubble();\n        this.bubbles[index].y = height + Math.random() * 20;\n      }\n    });\n  }\n\n  /**\n   * 绘制气泡\n   */\n  private drawBubbles(): void {\n    if (!this.ctx) return;\n\n    const width = this.canvas.width;\n    const height = this.canvas.height;\n    const bubbleColor = this.config.get('bubbleColor') || 'rgba(64, 158, 255, 0.6)';\n\n    // 清除画布\n    this.ctx.clearRect(0, 0, width, height);\n\n    // 绘制所有气泡\n    this.bubbles.forEach(bubble => {\n      this.ctx.save();\n      this.ctx.globalAlpha = bubble.alpha;\n\n      // 气泡主体\n      this.ctx.beginPath();\n      this.ctx.arc(bubble.x, bubble.y, bubble.radius, 0, Math.PI * 2);\n      this.ctx.fillStyle = bubbleColor;\n      this.ctx.fill();\n\n      // 高光效果\n      const gradient = this.ctx.createRadialGradient(\n        bubble.x - bubble.radius * 0.3,\n        bubble.y - bubble.radius * 0.3,\n        0,\n        bubble.x,\n        bubble.y,\n        bubble.radius\n      );\n      gradient.addColorStop(0, 'rgba(255, 255, 255, 0.8)');\n      gradient.addColorStop(0.3, 'rgba(255, 255, 255, 0.3)');\n      gradient.addColorStop(1, 'transparent');\n      this.ctx.fillStyle = gradient;\n      this.ctx.fill();\n\n      this.ctx.restore();\n    });\n  }\n\n  protected updateProgress(value: number): void {\n    if (this.textElement) {\n      this.textElement.textContent = this.formatText(value);\n    }\n  }\n\n  /**\n   * 销毁\n   */\n  destroy(): void {\n    this.stopAnimation();\n    super.destroy();\n  }\n}\n\n\n\n"],"names":["ProgressBase","createElement","canvasContextCache"],"mappings":"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"}